# Foreman Patch Management – Installation and Initial Setup (Patching Focused)

This document explains **installation assumptions and initial setup** required for **correct patch management using Foreman**.

This is **not** a full generic Foreman install guide.
Every point here exists **only because it affects patching reliability**.

Simple English. No fancy terms. Only real admin points.

---

## 1. Why Installation Quality Matters for Patching

Foreman patching fails mostly due to:

* Wrong hostname or FQDN
* DNS issues
* SSL problems
* Proxy misconfiguration
* Incorrect repo sync

If installation basics are wrong:

* Repos don’t sync
* Hosts cannot download packages
* Remote execution fails

So patching success starts at install time.

---

## 2. Foreman Server Role in Patching

The Foreman server acts as:

* Central control point
* Content source (via Katello)
* Certificate authority
* Job scheduler

All patch rules start here.
If this server is broken, **all managed hosts are affected**.

---

## 3. System Requirements (Patching Perspective)

Minimum practical requirements:

* Stable CPU and RAM (repo sync is heavy)
* Enough disk space for RPM storage
* Persistent storage (no temp disks)

Disk usage grows because:

* Multiple repo versions are stored
* Content View versions are retained

Running out of disk space = patching stops.

---

## 4. Hostname and FQDN (Critical)

Foreman **must** use a proper FQDN.

Example:

```
foreman.example.com
```

Why this matters:

* SSL certificates are generated using FQDN
* Clients validate hostname during HTTPS

Check:

```bash
hostname
hostname -f
```

If hostname is wrong:

* SSL errors occur
* Clients refuse to connect

---

## 5. DNS Requirements

Foreman relies on DNS.

Required:

* Forward DNS record for Foreman
* Reverse DNS (recommended)

Test:

```bash
nslookup foreman.example.com
```

If DNS is unstable:

* Repo sync may work sometimes
* Client downloads fail randomly

---

## 6. Time Synchronization

Time mismatch breaks SSL.

All systems must have:

* Correct date and time
* NTP enabled

Check:

```bash
timedatectl
```

If time is wrong:

* Certificates look expired or not yet valid
* SSL handshake fails

---

## 7. Certificates Generated by Foreman

During installation, Foreman:

* Creates its own internal CA
* Signs server and proxy certificates

These certificates are used by:

* Web UI
* Repository access
* Client communication

This is why client-side CA trust is required.

---

## 8. Smart Proxy Setup (Patch Execution Dependency)

Smart Proxy is required for:

* Remote execution
* Job invocation

If Smart Proxy is not working:

* Patching jobs will not run
* UI may look fine, but nothing executes

Check services:

```bash
systemctl status foreman-proxy
```

---

## 9. Katello Installation (Mandatory for Patching)

Katello enables:

* Repository management
* Content Views
* Lifecycle Environments

Without Katello:

* Foreman cannot control packages
* Patching becomes manual again

Verify:

```bash
foreman-maintain health check
```

---

## 10. Initial Web UI Checks After Install

Login to Foreman Web UI.

Verify these paths:

* Content → Products
* Content → Repositories
* Content → Content Views
* Content → Lifecycle Environments

If these menus are missing:

* Katello is not installed or broken

---

## 11. Firewall and Port Requirements

Required ports (common):

* 443 (HTTPS)
* 5647 (proxy to proxy communication)

If blocked:

* Hosts cannot download packages
* Jobs fail silently

Check:

```bash
ss -tulpn | grep 443
```

---

## 12. Client Registration Assumptions

Managed hosts must:

* Trust Foreman CA
* Use Foreman as package source

After registration:

```bash
dnf repolist
```

Expected result:

* Repositories point to Foreman
* No direct internet repos

---

## 13. Common Setup Mistakes That Break Patching

Avoid these:

* Changing hostname after install
* Manual editing of repo files on clients
* Skipping CA trust setup
* Installing Foreman without Katello
* Running patch commands outside Foreman

These cause long-term patching issues.

---

## 14. What You Should Be Able to Verify After This File

You should clearly know:

* Why Foreman install quality affects patching
* Which services must be running
* How SSL and DNS affect repo downloads
* Why client trust is mandatory

---

